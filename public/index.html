<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    Telegram.WebApp.expand();
  </script>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <meta charset="utf-8" />
  <link rel="icon" href="%PUBLIC_URL%/favicon-16x16.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <link rel="apple-touch-icon" href="%PUBLIC_URL%/apple-touch-icon.png" />
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
  <title>Lottery App</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
<!-- Заставка -->
<div class="splash-screen">
  <div class="splash-text tracking-in-expand">
    <span>ONE</span><br>
    <span>CLICK</span><br>
    <span>LOTTERY</span>
  </div>
</div>
<!-- Кнопка подключения кошелька -->
<div id="Connect" class="connect-wallet-button"></div>

<div class="container">
  <div class="main-container">
    <div class="jackpot-container">
      <div class="jackpot-text">Quick Play</div>
      <div class="jackpot-text">Top Prize 1,000 TON</div>
    </div>

    <div class="info-container">
      <div class="fixed-text">Rules of the game:</div>
      <div class="instant-lottery-rules">
        <p class="rule">Buy an instant ticket for 0.2 TON</p>
        <p class="rule">Possible winnings from 0.2 TON to 1000 TON.</p>
        <p class="rule">All payments are made automatically to your authorized wallet.</p>
      </div>
    </div>

    <!-- Кнопка покупки билета -->
    <div class="buy-ticket-container" onclick="startTransaction()">
      <img src="lottery-button.png" alt="Ticket Icon"> <!-- Картинка билета -->
      <span class="buy-ticket-text">Buy one ticket</span> <!-- Текст -->
    </div>
  </div>
  <!-- Всплывающее окно -->
  <div id="popup" class="popup">
    <button class="close-button" onclick="closePopup()">&times;</button>
    <p id="popup-text">Processing...</p>
    <div class="popup-img-container">
      <img src="Animation1.gif" alt="Processing">
    </div>
  </div>
</div>

<script>

  window.onload = function() {
    setTimeout(function() {
      document.querySelector('.splash-screen').classList.add('fade-out');

      setTimeout(function() {
        document.querySelector('.splash-screen').style.display = 'none';
      }, 1000); // 1 секунда
    }, 3000); // 3 секунды
  };

  const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: 'https://appcreator-sudo-game-e5c7.twc1.net/tonconnect-manifest.json',
    buttonRootId: 'Connect'
  });

  async function startTransaction() {
    const transaction = {
      validUntil: Math.round(Date.now() / 1000) + 60,
      messages: [
        {
          address: "UQDOTWT4TqDxyzDT62Khya1GnNNm-THQNsZO83S_ViBxw1ob",
          amount: "200000000" // Toncoin в нанотонах 0,2
        }
      ]
    };

    try {
      await tonConnectUI.sendTransaction(transaction);
      showPopup(); // Показываем окно при успешной транзакции
      setTimeout(() => {
        const popupText = document.getElementById('popup-text');
        popupText.innerHTML = "No win this time"; // Меняем текст
      }, 2000);
    } catch (error) {
      console.error('Transaction failed:', error);
      // Обработка ошибки, если нужно
    }
  }

  function showPopup() {
    const popup = document.getElementById('popup');
    popup.classList.add('show'); // Показываем окно
  }

  document.addEventListener('DOMContentLoaded', function () {
    const collapsibleContainer = document.querySelector('.main-container');

    // Функция для переключения класса "expanded"
    function toggleExpand() {
      collapsibleContainer.classList.toggle('expanded');
    }

    // Открытие при клике на сам контейнер
    collapsibleContainer.addEventListener('click', function (event) {
      toggleExpand(); // Переключаем состояние, независимо от его текущего состояния
      event.stopPropagation(); // Останавливаем всплытие
    });

    // Закрытие при клике вне контейнера
    document.addEventListener('click', function (event) {
      if (!collapsibleContainer.contains(event.target)) {
        collapsibleContainer.classList.remove('expanded');
      }
    });

    // Обработчик клика на кнопку покупки билета
    const buyTicketContainer = document.querySelector('.buy-ticket-container');
    buyTicketContainer.addEventListener('click', function (event) {
      event.stopPropagation(); // Останавливаем всплытие только для кнопки покупки
      startTransaction(); // Запускаем транзакцию при нажатии на кнопку
    });
  });



</script>
</body>
</html>
